<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Closing 2025 | Penunjang Medis RS Mitra Plumbon</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { background:#f4f6f9; font-family:Segoe UI,Arial; }
.card { border-radius:16px; box-shadow:0 8px 20px rgba(0,0,0,.08); }
.hidden { display:none; }

/* === SPINNER KEREN === */
.spinner-bg {
  min-height: 100vh;
  background: radial-gradient(circle at top, #1e3c72, #0f2027);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
}
.spinner-card {
  background: rgba(255,255,255,0.12);
  backdrop-filter: blur(14px);
  border-radius: 24px;
  padding: 50px;
  max-width: 900px;
  width: 100%;
  box-shadow: 0 20px 50px rgba(0,0,0,.4);
}
.spin-name {
  font-size: 3rem;
  font-weight: 800;
  margin: 40px 0;
}
.spin-running {
  animation: shake .15s infinite;
}
@keyframes shake {
  0% { transform: translateX(-5px); }
  50% { transform: translateX(5px); }
  100% { transform: translateX(-5px); }
}
</style>
</head>

<body>
<div class="container py-4">

<!-- MENU -->
<div class="d-flex justify-content-between mb-3">
  <h4 class="fw-bold">Closing 2025</h4>
  <div>
    <button class="btn btn-outline-primary btn-sm" onclick="showSection('main')">ğŸ  Utama</button>
    <button class="btn btn-outline-dark btn-sm" onclick="showSection('spinner')">ğŸ Spinner</button>
  </div>
</div>

<!-- ================= HALAMAN UTAMA ================= -->
<div id="main">

<div class="card p-4 mb-4 text-center">
  <h5 class="fw-bold">Undangan Rapat</h5>
  <h6>Penunjang Medis RS Mitra Plumbon</h6>
  <span class="badge bg-primary mt-2">Finish Strong 2025, Start Smart 2026</span>
</div>

<div class="card p-4 mb-4">
<table class="table table-borderless mb-0">
<tr><td>Hari / Tanggal</td><td>: Rabu, 17 Desember 2025</td></tr>
<tr><td>Waktu</td><td>: 13.00 WIB â€“ selesai</td></tr>
<tr><td>Tempat</td><td>: Ruang Perpus 3</td></tr>
<tr><td>Agenda</td>
<td>
â€¢ Konsep & Rangkaian Acara Closing 2025<br>
â€¢ Pembagian Peran & Timeline Kegiatan
</td></tr>
</table>
</div>

<div class="card p-4 mb-4">
<h5 class="fw-bold">Daftar Hadir</h5>
<form id="hadirForm">
  <input id="nama" class="form-control mb-3" placeholder="Nama" required>
  <input id="unit" class="form-control mb-3" placeholder="Unit" required>
  <button class="btn btn-primary w-100">Konfirmasi Kehadiran</button>
</form>
<div id="info" class="text-success mt-2 hidden">Kehadiran berhasil dicatat.</div>
</div>

<div class="card p-4">
<h5 class="fw-bold">ğŸ“Š Dashboard Kehadiran</h5>
<p>Total Hadir: <b id="total">0</b> orang</p>
<table class="table table-sm">
<thead><tr><th>Nama</th><th>Unit</th></tr></thead>
<tbody id="list"></tbody>
</table>
</div>

</div>

<!-- ================= SPINNER ================= -->
<div id="spinner" class="hidden spinner-bg">
  <div class="spinner-card text-center">
    <h2 class="fw-bold">ğŸ SPINNER TUKAR KADO</h2>
    <p class="opacity-75">Closing 2025 Penunjang Medis</p>

    <div id="spinNama" class="spin-name">SIAP DIUNDI</div>

    <div class="mt-4">
      <button id="spinBtn" class="btn btn-warning btn-lg px-5 me-2">ğŸ² SPIN</button>
      <button class="btn btn-light btn-lg px-4" onclick="toggleFull()">â›¶ FULLSCREEN</button>
    </div>

    <hr class="my-4 opacity-25">

    <h5 class="fw-bold mb-3">ğŸ† Riwayat Pemenang</h5>
    <ul id="winnerList" class="list-group list-group-flush text-dark"></ul>
  </div>
</div>

</div>

<!-- ================= FIREBASE ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getDatabase, ref, push, onValue, remove, serverTimestamp
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "ISI_API_KEY",
  authDomain: "closing-2025-penunjang-medis.firebaseapp.com",
  databaseURL: "https://closing-2025-penunjang-medis-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "closing-2025-penunjang-medis",
  storageBucket: "closing-2025-penunjang-medis.appspot.com",
  messagingSenderId: "ISI_SENDER_ID",
  appId: "ISI_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let peserta = [];

/* DAFTAR HADIR */
hadirForm.onsubmit = e => {
  e.preventDefault();
  push(ref(db,"daftar_hadir"), {
    nama:nama.value,
    unit:unit.value,
    waktu:serverTimestamp()
  });
  hadirForm.reset();
  info.classList.remove("hidden");
};

/* DASHBOARD */
onValue(ref(db,"daftar_hadir"), snap=>{
  list.innerHTML="";
  peserta=[];
  let c=0;
  snap.forEach(x=>{
    c++;
    peserta.push({key:x.key,...x.val()});
    list.innerHTML+=`<tr><td>${x.val().nama}</td><td>${x.val().unit}</td></tr>`;
  });
  total.innerText=c;
});

/* RIWAYAT PEMENANG */
onValue(ref(db,"pemenang"), snap=>{
  winnerList.innerHTML="";
  snap.forEach(x=>{
    winnerList.innerHTML+=`<li class="list-group-item">${x.val().nama} - ${x.val().unit}</li>`;
  });
});

/* SPINNER DRAMATIS */
spinBtn.onclick=()=>{
  if(!peserta.length) return alert("Peserta habis");

  spinNama.classList.add("spin-running");
  let count=0;

  const roll=setInterval(()=>{
    const temp=peserta[Math.floor(Math.random()*peserta.length)];
    spinNama.innerText=temp.nama.toUpperCase();
    count++;

    if(count>25){
      clearInterval(roll);
      spinNama.classList.remove("spin-running");

      const win=peserta[Math.floor(Math.random()*peserta.length)];
      spinNama.innerText=`ğŸ‰ ${win.nama} (${win.unit}) ğŸ‰`;

      push(ref(db,"pemenang"), win);
      remove(ref(db,"daftar_hadir/"+win.key));
    }
  },100);
};
</script>

<script>
function showSection(id){
  main.classList.add("hidden");
  spinner.classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}
function toggleFull(){
  !document.fullscreenElement
    ? document.documentElement.requestFullscreen()
    : document.exitFullscreen();
}
</script>

</body>
</html>
